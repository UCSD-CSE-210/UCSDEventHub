{% extends 'base.html' %}
{% load staticfiles %}
<html>
    <head>
    	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
		<link rel="stylesheet" type="text/css" href="{% static "css/eventDetailsStyle.css" %}">
		<link href="//fonts.googleapis.com/css?family=Lobster&subset=latin,latin-ext" rel="stylesheet" type="text/css">
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"
 integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
 crossorigin="anonymous"></script>
   		<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" type="text/css" />

    </head>
    <body>

    {% block title_content %}
    <h1 class = "eventTitle">{{ event.title }}</h1>
    {% endblock %}
    {% block content %}
    <div class="row">
		<div class ="col"></div>
		<div class = "col-md-10">
			<div class="event_tile_wrapper no-padding">
				<div class="poster">
					<img src="{{event.image_url}}" class="poster_image img-responsive"/>
				</div>
				<div class="details">
					<div class="title">
						<p class="p_title">
							{{event.title}}
						</p>
					</div>
					<div class="datetime">
						<p class="p_datetime">
							{{  event.start_day }}
							{%  if not event.ending_same_day %}
							  - {{event.end_day}}
							{%  endif%}
						</p>
					</div>
					<div class="datetime">
						<p class="p_datetime">
							{{  event.start_time }} - {{  event.end_time }}
						</p>
					</div>
					<div class="location">
						<p class="p_location">
							At: {{event.location}}
						</p>
					</div>
					<div class="organizer">
						<p class="p_organizer">
							By: <a href="{{ event.organizer_url }}">
								{{event.org_name}}
								</a>
						</p>
					</div>

					<div>
						<a href="http://www.google.com/calendar/event?action=TEMPLATE&text={{event.title}}&dates={{event.googleDate}}&details={{event.description}}&location={{event.location}}&trp=false&sprop=&sprop=name" target="_blank" class="btn btn-default">
							<p class="p_calendar">
							Add to calendar
							</p>
						</a>

						<div>
							<p class="hashtagContent">
								{{  event.hashtags }}

							</p>
						</div>
					</div>


				</div>
			<br style="clear: both;">
			</div>
		</div>
		<div class ="col"></div>

	</div>
	<div class="row" style="margin-top:10px">
		<div class ="col"></div>
		<div class = "col-md-10">

			<div id="wrapper">
				<div class ="description">
					<h3 class ="heading">Description</h3>
					<div style="padding-bottom:20px">
						<p class="p_description">{{event.description}}</p>
					</div>
					<h3 class="heading">Categories</h3>
						<ul>
						{% for c in event.categories %}
							<li>
								<h4 style="color:#5a5a5a">{{ c.categories__category }}</h4>
							</li>
							{% endfor %}
						</ul>
					<p></p>
					<div  class="text">
						<div>
							<p><h3 class ="heading">Tags</h3></p>
							<p class="p_hashtag">
								{{  event.hashtags }}
							</p>
						</div>
					</div>
				</div>
				<div class ="sidecolumn" id = "rsvpCol">
					
						{% if event.rsvpd %}
							<input type="button" id = "removeRSVP" onclick="remove_rsvp()" value="Remove RSVP">
						{% else %}

							{%if event.user.is_anonymous or is_user_attendee%}
							<input type="button" id="saveRSVP" onclick="save_rsvp({{ event.user.is_authenticated|yesno:'true,false' }})" value="RSVP">
							{% endif %}
						{% endif %}

				</div>
			</div>
		</div>
		<div class ="col"></div>
	</div>
	<script type="text/javascript">
		function makeAJAXCall(url,flag){
			var eventId = "{{event.id}}";
			var userId = "{{event.user.id}}";

			var request = $.ajax({
		        url: url,
		        type: 'GET',
		        data: {
		          'userId': userId,
		          'eventId': eventId
		        },
		        dataType: 'json',

		    });

			request.done(function(data) {
				if(flag){

					var saveRSVPBtn = document.getElementById("saveRSVP");
					saveRSVPBtn.parentNode.removeChild(saveRSVPBtn);
					var sidecolumnDiv = document.getElementById("rsvpCol");
    				var removeRSVPBtn = document.createElement("button");
    				removeRSVPBtn.id="removeRSVP";
					removeRSVPBtn.innerHTML = "Remove RSVP";
					removeRSVPBtn.addEventListener ("click", remove_rsvp);
					sidecolumnDiv.appendChild(removeRSVPBtn);
					alert('Your RSVP has been saved successfully!');

				}else{

					var removeRSVPBtn = document.getElementById("removeRSVP");
					removeRSVPBtn.parentNode.removeChild(removeRSVPBtn);
					var sidecolumnDiv = document.getElementById("rsvpCol");
    				var saveRSVPBtn = document.createElement("button");
    				saveRSVPBtn.id="saveRSVP";
					saveRSVPBtn.innerHTML = "RSVP";
					saveRSVPBtn.addEventListener ("click", save_rsvp);
					sidecolumnDiv.appendChild(saveRSVPBtn);
					alert('Your RSVP has been removed successfully!');

				}

			});

			request.fail(function(jqXHR, textStatus) {
			      alert({
					    title: 'Confirmation',
					    content: 'Failed to process your request.',
					});
			});
		}

		function remove_rsvp(){
			makeAJAXCall('/ajax/removeRSVP/',false)
		}

		function save_rsvp(is_auth){
			if (is_auth){
				makeAJAXCall('/ajax/saveRSVP/',true);
			} else {
				window.location.href = "/login/";
			}

		}
	</script>

{% endblock %}
</body>
</html>